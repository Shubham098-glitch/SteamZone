<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - SteamZone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="app.js"></script>
    <style>
        .status-pending { background-color: #FEF3C7; color: #92400E; }
        .status-verified { background-color: #D1FAE5; color: #065F46; }
        .status-badge { display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-blue-900 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-gamepad text-2xl"></i>
                <a href="index.html" class="text-2xl font-bold">SteamZone</a>
            </div>
            <nav class="hidden md:flex space-x-6 items-center">
                <a href="index.html" class="hover:text-blue-200">Home</a>
                <a href="search.html" class="hover:text-blue-200">Search</a>
                <a href="contact.html" class="hover:text-blue-200">Contact</a>
                <a href="login.html" id="loginLink" class="hover:text-blue-200">Login</a>
                <a href="my-orders.html" id="myOrdersLink" class="font-semibold hover:text-blue-200">My Orders</a>
                <span id="profileName" class="hidden bg-yellow-500 text-gray-900 w-8 h-8 rounded-full flex items-center justify-center font-bold"></span>
                <button id="logoutBtn" class="hidden hover:text-blue-200">Logout</button>
            </nav>
            <button class="md:hidden text-xl">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">My Orders</h1>
            
            <!-- Orders List -->
            <div id="ordersList" class="space-y-4">
                <!-- Orders will be loaded here -->
                <div class="text-center py-8">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                    <p class="mt-4 text-gray-600">Loading your orders...</p>
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="hidden text-center py-12">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-shopping-bag text-gray-400 text-2xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No orders yet</h3>
                <p class="text-gray-500 mb-6">You haven't placed any orders yet.</p>
                <a href="index.html" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Browse Games
                </a>
            </div>
        </div>
    </main>

    <!-- Order Details Modal -->
    <div id="orderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">Order Details</h2>
                        <p class="text-sm text-gray-500" id="orderNumber">#---</p>
                    </div>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <p class="text-sm text-gray-500">Game</p>
                        <p class="font-medium" id="orderGame">---</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Order Date</p>
                        <p id="orderDate">---</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Amount</p>
                        <p class="font-medium" id="orderAmount">---</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Status</p>
                        <p><span id="orderStatus" class="status-badge">---</span></p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">UTR Number</p>
                        <p class="font-mono" id="orderUtr">---</p>
                    </div>
                </div>
                
                <div class="border-t border-gray-200 pt-4">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">Need Help?</h3>
                    <p class="text-sm text-gray-600 mb-4">Contact our support team for any questions about your order.</p>
                    <div class="flex space-x-3">
                        <a href="mailto:support@steamzone.com" class="flex-1 text-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-envelope mr-2"></i> Email
                        </a>
                        <a href="tel:+919876543210" class="flex-1 text-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-phone-alt mr-2"></i> Call
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 SteamZone. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Global variable to store orders
        let userOrders = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            const loginLink = document.getElementById('loginLink');
            const myOrdersLink = document.getElementById('myOrdersLink');
            const logoutBtn = document.getElementById('logoutBtn');
            const profileName = document.getElementById('profileName');
            const ordersList = document.getElementById('ordersList');
            const emptyState = document.getElementById('emptyState');
            const orderModal = document.getElementById('orderModal');
            const closeModal = document.getElementById('closeModal');

            function updateAuthUI() {
                const user = getCurrentUser();
                if (user) {
                    if(loginLink) loginLink.classList.add('hidden');
                    if(myOrdersLink) myOrdersLink.classList.remove('hidden');
                    if(logoutBtn) logoutBtn.classList.remove('hidden');
                    if(profileName) {
                        profileName.classList.remove('hidden');
                        profileName.textContent = user.email.substring(0, 2).toUpperCase();
                    }
                } else {
                    // If not logged in, redirect to login page
                    window.location.href = 'login.html?redirect=my-orders';
                }
            }
            
            // Load user's orders
            function loadUserOrders() {
                const user = getCurrentUser();
                if (!user) return; // Should be handled by updateAuthUI, but as a safeguard

                const allOrders = JSON.parse(localStorage.getItem('steamzone_orders') || '[]');
                userOrders = allOrders.filter(order => order.userId === user.id);
                
                if (userOrders.length === 0) {
                    ordersList.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                // Sort by date (newest first)
                userOrders.sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));
                
                // Render orders
                ordersList.innerHTML = userOrders.map(order => {
                    const orderDate = new Date(order.orderDate);
                    const formattedDate = orderDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    const statusClass = order.status === 'Verified' ? 'status-verified' : 'status-pending';
                    
                    return `
                        <div class="bg-white rounded-lg shadow overflow-hidden">
                            <div class="p-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium text-gray-900">${order.gameTitle}</h3>
                                        <p class="text-sm text-gray-500 mt-1">Order #${order.id} â€¢ ${formattedDate}</p>
                                    </div>
                                    <span class="status-badge ${statusClass}">
                                        ${order.status}
                                    </span>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <p class="text-lg font-medium">â‚¹${order.price.toLocaleString()}</p>
                                    <button onclick="viewOrderDetails('${order.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                        View Details <i class="fas fa-chevron-right ml-1 text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                emptyState.classList.add('hidden');
                ordersList.classList.remove('hidden');
            }
            
            // Close modal
            closeModal.addEventListener('click', function() {
                orderModal.classList.add('hidden');
            });
            
            // Close modal when clicking outside
            orderModal.addEventListener('click', function(e) {
                if (e.target === orderModal) {
                    orderModal.classList.add('hidden');
                }
            });
            
            // Logout
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    logout();
                    window.location.href = 'index.html';
                });
            }
            
            // Initialize
            updateAuthUI();
            loadUserOrders();
        });
        
        // View order details
        function viewOrderDetails(orderId) {
            const order = userOrders.find(o => o.id == orderId);
            if (!order) return;
            
            const orderDate = new Date(order.orderDate);
            const formattedDate = orderDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const statusClass = order.status === 'Verified' ? 'status-verified' : 'status-pending';
            
            document.getElementById('orderNumber').textContent = `#${order.id}`;
            document.getElementById('orderGame').textContent = order.gameTitle;
            document.getElementById('orderDate').textContent = formattedDate;
            document.getElementById('orderAmount').textContent = `â‚¹${order.price.toLocaleString()}`;
            document.getElementById('orderStatus').textContent = order.status;
            document.getElementById('orderStatus').className = `status-badge ${statusClass}`;
            document.getElementById('orderUtr').textContent = order.utrNumber || 'N/A';
            
            document.getElementById('orderModal').classList.remove('hidden');
        }
    </script>
</body>
</html>
